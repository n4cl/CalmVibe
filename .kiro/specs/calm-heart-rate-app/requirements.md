# Requirements Document

## Introduction
不安や動揺で鼓動が高まったときに、**一定リズムの心拍ガイド（BPMベース）と呼吸ガイド（フェーズ秒数ベース）を独立した機能として提供し、状況に応じて選択できる**スマホアプリMVP。振動と視覚ガイドは両モードで利用し、心拍は手入力のみでセッション前後に記録・振り返りできる（自動計測・外部同期は行わない）。

## Requirements

### Requirement 1: 心拍リズム設定（セッション画面内）
**Objective:** ユーザーとして、発作時に画面遷移せずBPMと時間を即座に調整し、同期を始めたい（振動強度選択は廃止）。

#### Acceptance Criteria (EARS日本語表現)
1. ユーザーがセッション画面の設定セクションでBPMスライダーを操作したとき、システムは設定値を40〜90 BPMの範囲・1刻みで保存する。
2. **（廃止）振動強度の選択は提供しない（Expo Goで振幅制御不可のため）。**
3. ユーザーが開始を押したとき、システムは現在の設定で心拍ガイドを即時開始し、ユーザーが停止するまで継続する（時間設定がある場合はその上限で停止し、Webでは無振動でもエラーなく動作する）。
4. セッションを新規開始するとき、システムは直近保存したBPM・強度・時間設定を自動適用する。
5. ユーザーが設定時間を60〜300秒の範囲で変更する、または「無制限」を選択したとき、システムはその値（無制限の場合は上限なし）を保存し、いつでも手動停止を受け付ける。
6. ユーザーが「デフォルトに戻す」を選択したとき、システムは心拍設定（BPM=60、時間=180）を即時反映し保存する（強度は対象外）。

### Requirement 2: ガイド提示（心拍ガイド / 呼吸ガイド）
**Objective:** ユーザーとして、選択したガイド（心拍ガイド=BPMベース / 呼吸ガイド=フェーズ秒数ベース）で振動と視覚の両方からペースを得て、画面を見ない状況でも呼吸を整えたい。

#### Acceptance Criteria (EARS日本語表現)
1. ユーザーが心拍ガイドを開始したとき、システムは設定BPMで単発振動を周期実行し、視覚ガイドを同期表示する。
2. 心拍ガイド実行中、システムは振動周期の誤差を設定BPMに対して±5%以内に保つ。
3. ユーザーが視覚ガイドをOFFにしたとき、システムは心拍ガイドのみ継続し、画面が見られない環境でもペース提示を続ける。
4. 設定時間を経過するかユーザーが手動停止したとき、システムはガイドを確実に停止し終了メッセージを表示する。
5. ユーザーが呼吸ガイドを開始したとき、システムは吸う/止める/吐く各フェーズ開始タイミングで振動を出力し、視覚ガイドをフェーズに同期して表示する（BPM設定の影響を受けない）。

### Requirement 3: ガイド設定・モード選択（独立保持）
**Objective:** ユーザーとして、「心拍ガイド（BPM）」または「呼吸ガイド（フェーズ秒数）」を選び、双方の設定を独立に保持したい。呼吸ガイドでは2フェーズ（吸う/吐く）と3フェーズ（吸う/止める/吐く）を設定でき、サイクル回数も指定したい。

#### Acceptance Criteria (EARS日本語表現)
1. ユーザーが呼吸プリセットを選択したとき、システムはプリセット種別（2フェーズ/3フェーズ）と各フェーズ秒数（吸う、止める※3フェーズ時のみ、吐く）をセッション画面内で保存する（デフォルト値を提供する）。
2. ユーザーがサイクル回数を指定したとき、システムはその回数分サイクルを実行する。回数指定が「∞」の場合、手動停止または時間設定で停止できるようにする。
3. ユーザーが「デフォルトに戻す」を選択したとき、システムは呼吸プリセットをデフォルト（例: 4-6-4 三フェーズ、サイクル=∞）に戻して保存する。
4. ユーザーがセッション開始前にモードを「心拍ガイド」または「呼吸ガイド」から選択したとき、システムは選択に従いガイドを起動し、呼吸設定が心拍BPM設定に影響しないことを保証する。
5. ユーザーが次のセッションで異なるモードを選択したとき、システムは前回の選択に依存せず新しいモードで開始できるようにする。

### Requirement 4: セッション記録と振り返り
**Objective:** ユーザーとして、セッション前後の状態や体感を記録し、後から効果を振り返りたい。

#### Acceptance Criteria (EARS日本語表現)
1. ユーザーがセッション開始前に心拍数を入力したとき、システムは値を記録し、未入力でも開始できるようにする。
2. セッション終了直後に心拍数を入力したとき、システムは終了時心拍として保存する。
3. セッション完了時、システムは使用ガイド種別（振動/呼吸）をユーザー選択で保存する。
4. セッション完了時、システムは体感（落ち着き度・心地よさなど）を3〜5段階で入力・保存できるようにする。
5. セッション完了時、システムは改善度を5段階で入力・保存できるようにする。
6. ユーザーが履歴一覧を閲覧するとき、システムは各セッションの開始/終了心拍・ガイド種別・体感入力・改善度を表示する。

### Requirement 5: ナビゲーション（タブ構成）
**Objective:** ユーザーとして、迷わずセッション開始や履歴確認に辿り着けるよう、主要機能を明確なタブで切り替えたい。

#### Acceptance Criteria (EARS日本語表現)
1. ユーザーがアプリを開いたとき、タブバーに「セッション」と「履歴」の2タブのみが表示され、不要なタブ（Home/Explore等）は存在しない。
2. デフォルトで「セッション」タブが選択され、1タップでガイド開始操作に着手できる。
3. ユーザーが「履歴」タブを選択したとき、最新順のセッション履歴一覧に1タップでアクセスできる。
4. タブを切り替えても直前の設定値や入力途中の内容が失われない（セッション開始前の設定は保持する）。
