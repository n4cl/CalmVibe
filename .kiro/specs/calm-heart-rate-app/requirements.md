# Requirements Document

## Introduction
不安や動揺で鼓動が高まったときに、**一定リズムの振動で呼吸ペースを整え、落ち着きを取り戻す**ことを主目的とするスマホアプリMVP。振動による心拍同期と視覚呼吸ガイドを独立した機能として扱い、必要に応じて併用する。心拍は手入力のみでセッション前後に記録・振り返りできる（自動計測・外部同期は行わない）。

## Requirements

### Requirement 1: 振動リズム設定（セッション画面内）
**Objective:** ユーザーとして、発作時に画面遷移せずBPMと時間・強度を即座に調整し、同期を始めたい。

#### Acceptance Criteria (EARS)
1. When ユーザーがセッション画面の設定セクションでBPMスライダーを操作したとき, the システム shall 設定値を40〜90 BPMの範囲・1刻みで保存する.
2. When ユーザーが強度を選択したとき, the システム shall 強度（弱/中/強）を保存し、全ガイドに適用する.
3. When ユーザーが「プレビュー」を押したとき, the システム shall 1拍1振動を1回再生し（Webでは無振動でエラーなく）体感させる.
4. When セッションを新規開始するとき, the システム shall 直近保存したBPM・強度・時間設定を自動適用する.
5. While ユーザーが設定時間を60〜300秒の範囲で変更したとき, the システム shall その値を保存し, and the システム shall いつでも手動停止を受け付ける.

### Requirement 2: 呼吸ペースガイド提示（振動＋視覚）
**Objective:** ユーザーとして、吸う/吐くの切替タイミングを振動と視覚で得て、画面を見ない状況でも呼吸を整えたい。

#### Acceptance Criteria (EARS)
1. When ユーザーが「開始」を押しデフォルトモードで起動したとき, the システム shall 事前設定BPMで単発振動を周期実行し、視覚ガイドを同期表示する.
2. While ガイド実行中, the システム shall 振動周期の誤差を設定BPMに対して±5%以内に保ち, and the システム shall 吸気/呼気切替のキューとして1拍1振動を出力する.
3. When ユーザーが視覚ガイドをOFFにしたとき, the システム shall 振動ガイドのみ継続し、画面が見られない環境でもペース提示を続ける.
4. When 設定時間を経過する または ユーザーが手動停止したとき (whichever occurs first), the システム shall ガイドを確実に停止し終了メッセージを表示する.

### Requirement 3: 呼吸ガイド設定・モード選択（振動と独立だが併用可）
**Objective:** ユーザーとして、状況に応じて呼吸ガイドのみ/振動のみ/併用を選び、呼吸プリセットは振動設定と独立に保持したい。

#### Acceptance Criteria (EARS)
1. When ユーザーが呼吸プリセットを選択したとき, the システム shall テンポ（例: 4-6-4, 5-5-5, 4-4-4）をセッション画面内で保存する.
2. When ユーザーがセッション開始前にモードを「振動のみ」「呼吸のみ（視覚）」「併用」から選択したとき, the システム shall 選択に従いガイドを起動し, and the システム shall 呼吸プリセットが振動BPM設定に影響しないことを保証する.
3. When ユーザーが次のセッションで異なるモードを選択したとき, the システム shall 前回の選択に依存せず新しいモードで開始できるようにする.

### Requirement 4: セッション記録と振り返り
**Objective:** ユーザーとして、セッション前後の状態や体感を記録し、後から効果を振り返りたい。

#### Acceptance Criteria (EARS)
1. When ユーザーがセッション開始前に心拍数を入力したとき, the システム shall 値を記録し, and the システム shall 未入力でも開始できるようにする.
2. When セッション終了直後に心拍数を入力したとき, the システム shall 終了時心拍として保存する.
3. When セッション完了時, the システム shall 使用ガイド種別（振動/呼吸/併用）をユーザー選択で保存する.
4. When セッション完了時, the システム shall 体感（落ち着き度・心地よさ・振動強さの感じ方など）を3〜5段階で入力・保存できるようにする.
5. When セッション完了時, the システム shall 改善度を5段階で入力・保存できるようにする.
6. While ユーザーが履歴一覧を閲覧するとき, the システム shall 各セッションの開始/終了心拍・ガイド種別・体感入力・改善度を表示する.
