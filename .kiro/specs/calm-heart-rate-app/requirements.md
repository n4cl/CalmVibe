# Requirements Document

## Introduction
不安や動揺で鼓動が高まったときに、**一定リズムの振動で呼吸ペースを整え、落ち着きを取り戻す**ことを主目的とするスマホアプリMVP。振動による心拍同期と視覚呼吸ガイドを独立した機能として扱い、必要に応じて切り替える。心拍は手入力のみでセッション前後に記録・振り返りできる（自動計測・外部同期は行わない）。

## Requirements

### Requirement 1: 振動リズム設定（セッション画面内）
**Objective:** ユーザーとして、発作時に画面遷移せずBPMと時間・強度を即座に調整し、同期を始めたい。

#### Acceptance Criteria (EARS日本語表現)
1. ユーザーがセッション画面の設定セクションでBPMスライダーを操作したとき、システムは設定値を40〜90 BPMの範囲・1刻みで保存する。
2. ユーザーが強度を選択したとき、システムは強度（弱/中/強）を保存し、全ガイドに適用する。
3. ユーザーが「プレビュー」を押したとき、システムは1拍1振動を1回再生し（Webでは無振動でエラーなく）体感させる。
4. セッションを新規開始するとき、システムは直近保存したBPM・強度・時間設定を自動適用する。
5. ユーザーが設定時間を60〜300秒の範囲で変更している間、システムはその値を保存し、いつでも手動停止を受け付ける。
6. ユーザーが「デフォルトに戻す」を選択したとき、システムは振動設定（BPM=60、時間=180、強度=中）を即時反映し保存する。

### Requirement 2: 呼吸ペースガイド提示（振動または視覚）
**Objective:** ユーザーとして、吸う/吐くの切替タイミングを振動と視覚で得て、画面を見ない状況でも呼吸を整えたい（デフォルトは振動モード、必要に応じて呼吸ガイドモードに切替）。

#### Acceptance Criteria (EARS日本語表現)
1. ユーザーが「開始」を押しデフォルト（振動）モードで起動したとき、システムは事前設定BPMで単発振動を周期実行し、視覚ガイドはユーザー設定に従い同期表示する。
2. ガイド実行中、システムは振動周期の誤差を設定BPMに対して±5%以内に保ち、吸気/呼気切替のキューとして1拍1振動を出力する。
3. ユーザーが視覚ガイドをOFFにしたとき、システムは振動ガイドのみ継続し、画面が見られない環境でもペース提示を続ける。
4. 設定時間を経過するかユーザーが手動停止したとき、システムはガイドを確実に停止し終了メッセージを表示する。

### Requirement 3: 呼吸ガイド設定・モード選択（振動とは独立）
**Objective:** ユーザーとして、「振動のみ」または「呼吸ガイド（視覚）」を選び、呼吸プリセットを振動設定と独立に保持したい。呼吸ガイドでは2フェーズ（吸う/吐く）と3フェーズ（吸う/止める/吐く）のどちらも設定でき、サイクル回数も指定したい。

#### Acceptance Criteria (EARS日本語表現)
1. ユーザーが呼吸プリセットを選択したとき、システムはプリセット種別（2フェーズ/3フェーズ）と各フェーズ秒数（吸う、止める※3フェーズ時のみ、吐く）をセッション画面内で保存する（デフォルト値を提供する）。
2. ユーザーがサイクル回数を指定したとき、システムはその回数分サイクルを実行する。回数指定が「∞」の場合、手動停止または時間設定で停止できるようにする。
3. ユーザーが「デフォルトに戻す」を選択したとき、システムは呼吸プリセットをデフォルト（例: 4-6-4 三フェーズ、サイクル=∞）に戻して保存する。
4. ユーザーがセッション開始前にモードを「振動のみ」または「呼吸のみ（視覚）」から選択したとき、システムは選択に従いガイドを起動し、呼吸設定が振動BPM設定に影響しないことを保証する。
5. ユーザーが次のセッションで異なるモードを選択したとき、システムは前回の選択に依存せず新しいモードで開始できるようにする。

### Requirement 4: セッション記録と振り返り
**Objective:** ユーザーとして、セッション前後の状態や体感を記録し、後から効果を振り返りたい。

#### Acceptance Criteria (EARS日本語表現)
1. ユーザーがセッション開始前に心拍数を入力したとき、システムは値を記録し、未入力でも開始できるようにする。
2. セッション終了直後に心拍数を入力したとき、システムは終了時心拍として保存する。
3. セッション完了時、システムは使用ガイド種別（振動/呼吸）をユーザー選択で保存する。
4. セッション完了時、システムは体感（落ち着き度・心地よさ・振動の強さの感じ方など）を3〜5段階で入力・保存できるようにする。
5. セッション完了時、システムは改善度を5段階で入力・保存できるようにする。
6. ユーザーが履歴一覧を閲覧するとき、システムは各セッションの開始/終了心拍・ガイド種別・体感入力・改善度を表示する。
